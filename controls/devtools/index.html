<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="devtools.css" />
  </head>

  <body>
    <div class="devtools">
      <div class="top"></div>
      <iframe src="/devtools/blank.html" frameborder="0" scrolling="no"></iframe>
      <div class="resizearea"></div>
    </div>

    <!-- Scripts -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="/lib/jquery-2.1.1.min.js"></script>
    <script>
      var resizeHandle = {
        init : function() {
          $('.top').mousedown(this.start);
          $('.top, .resizearea').mouseup(this.end).mousemove(this.move);
        },
        vars : {
          origin : null,
          enabled : false,
          dimension : 400
        },
        start : function(e) {
          $(this).addClass('moving');
          resizeHandle.vars.origin = e.clientY;
          resizeHandle.vars.enabled = true;
          $('.resizearea').show();
        },
        move : function(e) {
          if (!resizeHandle.vars.enabled) {
            return;
          }

          var movementOffset = e.clientY - resizeHandle.vars.origin;
          movementOffset = movementOffset < 0 ? 0 : movementOffset;
          var newDimension = resizeHandle.vars.dimension - movementOffset;
          $('.top').css({ height : movementOffset + 3 });
          $('.devtools').css({ borderTopWidth : movementOffset + 3 });
          $('.resizearea').html(newDimension + ' px');
        },
        end : function(e) {
          if (!resizeHandle.vars.enabled) {
            return;
          }

          var movementOffset = e.clientY - resizeHandle.vars.origin;
          movementOffset = movementOffset < 0 ? 0 : movementOffset;
          var newDimension = resizeHandle.vars.dimension - movementOffset;
          resizeHandle.vars.dimension = newDimension;
          resizeHandle.vars.enabled = false;

          socket.emit('resize', newDimension);

          $('.top').removeClass('moving').css({ height : 3 });
          $('.devtools').css({ borderTopWidth : 3 });
          $('.resizearea').html('').hide();
        }
      };
      $(resizeHandle.init.bind(resizeHandle));
    </script>

    <!-- Main -->
    <script type="text/javascript">
      var devtools_url = '/devtools/blank.html';
      var socket = io.connect();
      socket.on('state', function(state) {
        if(state) {
          if(state.devtools_url !== devtools_url) {
            devtools_url = state.devtools_url;
            $('iframe').attr('src', devtools_url);
          }
        }
      });
      socket.emit('handshake', '_devtools');
    </script>
  </body>
</html>


